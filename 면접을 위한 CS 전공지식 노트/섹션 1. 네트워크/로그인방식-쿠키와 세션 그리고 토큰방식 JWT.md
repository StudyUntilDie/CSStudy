## 로그인, 쿠키와 세션, JWT 토큰
- HTTP는 stateless 하다. 즉, 연결을 끊는 순간 사용자와 서버의 통신이 끝나며 상태 정보가 유지되지 않는다.
- 때문에 로그인 유지를 위해 **상태**를 유지하기위 다음과 같은 방식을 사용한다.
  - 쿠키와 세션 방식
  - 토큰기반 방식
  
### 쿠키와 세션 방식
- 세션: 서버와 클라이언트의 연결의 활성화된 상태
- 세션ID: 웹 서버메모리에 저장된느 클라이언트에 대한 유니크한 ID(서버 또는 데이터베이스에 저장)
- 쿠키
  - '키 : 값' 으로 구성된 작은 데이터 조각
  - 쿠키에 담긴 데이터는 브라우저에서 관리한다.(but, 보통 만료날짜를 서버에서 설정)
  - 이름, 값, 만료 날짜 등으로 구성

### 쿠키와 세션의 상태유지 방식
1. 처음에 로그인을 하면 쿠키와 세션ID 생성
2. 이후에 다시 요청을 할때 HTTP 헤더에 쿠키를 포함시켜 요청
3. 해당 쿠키에 맞는 세션ID로 전에 로그인했던 아이디인지 확인
4. 맞다면 로그인을 유지

### 쿠키와 세션의 보안
- 쿠키는 클라이언트에서 자바스크립트로 조회가 가능하다. 그래서 공격자들이 자바스크립트 쿠키를 가로채고자 시도를 함. 이를 XSS라고 한다.(Cross Site Scripting)
- 해결방법: HTTP Only Cookie 또는 secure cookie를 사용. 사용 방법은 다음과 같은 코드를 추가해주면 된다.
  - Set-Cookie: 쿠키명=쿠키값; path=/; secure
  - Set-Cookie: 쿠키명=쿠키값; path=/; HttpOnly

### 쿠키와 세션 방식의 단점
- 로그인할 때마다 세션ID를 저장해야 해서 로그인 중인 유저의 수가 늘어나면 서버의 메모리 과부화 등의 악영향
- 이를 해결하기 위해 나온 방식으로 토큰기반인증 방식인 JWT토큰(대표적)이 있다.
- 서버는 stateless하게 내버려두고
- 요청이 오면 서버에서 토큰을 생성해 클라이언트에게 응답 이후 클라이언트가 토큰을 헤더에 담아 전송

### JWT(JSON Web Token, RFC 7519)
헤더, 페이로드, 서명으로 이루어져 있으며 JSON 객체로 인코딩된다. 메시지 인증 암호화에 사용

- Header  
어떠한 방법의 서명 알고리즘을 사용할 것인가에 대한 정보.
- Payload  
데이터, 토큰 발급자, 토큰 유효기관(인증이 필요한 최소한의 정보만) -> 탈취당할 가능성이 존재해서
- Signature  
헤더에 정의된 알고리즘으로 인코딩된 헤더와 페이로드를 합친값, 그리고 비밀키를 기반으로 생성된 서명값

### JWT 장점
- 사용자가 안등되면 사용자는 모든 시스템에서 사용할 수 있는 보안 토큰을 받습니다.  
-> 단일 엔드포인트를 생성해서 다른 모든 서버간의 API 상호작용을 인증할 수 있다는 점에서 좋다.
- 사용자 인증에 필요한 모든 정보는 토큰 자체에 포함하기 때문에 별도의 인증 저장소가 필요 없다.
  - 세션의 경우 계속해서 저장해야한다.
- 확장성, 디버깅, 사이즈가 작다. JWT토큰 자체가 독립적

### JWT 단점
- 더 많은 필드가 추가되면 토큰이 비대해져 트래픽에 영향
- 탈취하여 디코딩하면 데이터를 볼 수 있다.
